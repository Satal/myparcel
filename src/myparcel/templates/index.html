{% extends "base.html" %}

{% block title %}Dashboard - MyParcel{% endblock %}

{% block content %}
<div class="dashboard">
    <section class="add-parcel">
        <h2>Track a Parcel</h2>
        <form action="/parcel/add" method="post" class="add-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="tracking_number">Tracking Number</label>
                    <input
                        type="text"
                        id="tracking_number"
                        name="tracking_number"
                        placeholder="Enter tracking number"
                        required
                        hx-get="/api/detect-carrier"
                        hx-trigger="input changed delay:500ms"
                        hx-target="#carrier-detect"
                    >
                </div>
                <div class="form-group">
                    <label for="carrier_id">Carrier</label>
                    <select id="carrier_id" name="carrier_id">
                        <option value="">Auto-detect</option>
                        {% for carrier in carriers %}
                        <option value="{{ carrier.id }}">{{ carrier.name }}</option>
                        {% endfor %}
                    </select>
                    <small id="carrier-detect"></small>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="description">Description (optional)</label>
                    <input
                        type="text"
                        id="description"
                        name="description"
                        placeholder="e.g., New headphones"
                    >
                </div>
                <div class="form-group">
                    <label for="sender">Sender (optional)</label>
                    <input
                        type="text"
                        id="sender"
                        name="sender"
                        placeholder="e.g., Amazon"
                    >
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Add Parcel</button>
        </form>
    </section>

    <section class="parcels-list">
        <h2>Your Parcels</h2>
        {% if parcels %}
        <div class="parcel-grid">
            {% for parcel in parcels %}
            <article class="parcel-card status-{{ parcel.status.value }}">
                <div class="parcel-header">
                    <span class="carrier-badge">{{ parcel.carrier.name }}</span>
                    <span class="status-badge">{{ parcel.status.value | replace('_', ' ') | title }}</span>
                </div>
                <div class="parcel-body">
                    <h3>
                        {% if parcel.description %}
                            {{ parcel.description }}
                        {% else %}
                            {{ parcel.tracking_number }}
                        {% endif %}
                    </h3>
                    <p class="tracking-number">{{ parcel.tracking_number }}</p>
                    {% if parcel.sender %}
                    <p class="sender">From: {{ parcel.sender }}</p>
                    {% endif %}
                    {% if parcel.last_status_text %}
                    <p class="last-status">{{ parcel.last_status_text }}</p>
                    {% endif %}
                </div>
                <div class="parcel-footer">
                    <a href="/parcel/{{ parcel.id }}" class="btn btn-small">Details</a>
                    <form action="/parcel/{{ parcel.id }}/refresh" method="post" class="inline-form">
                        <button type="submit" class="btn btn-small btn-secondary">Refresh</button>
                    </form>
                </div>
            </article>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <p>No parcels being tracked yet.</p>
            <p>Add a tracking number above to get started!</p>
        </div>
        {% endif %}
    </section>
</div>
{% endblock %}
